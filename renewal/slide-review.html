<!-- 
	ìŠ¬ë¼ì´ë“œ ë¦¬ë·° ì„¹ì…˜
	renewal/slide-review.html

	"id": ë¸Œì´ë¦¬ë·°ID (ê°œë°œìë„êµ¬ì—ì„œ í™•ì¸)
	"iconPosition": '+'ì•„ì´ì½˜ì˜ ì¢Œí‘œ(x,y). ì¢Œìƒë‹¨ì€ (0,0) ìš°í•˜ë‹¨ì€ (100,100)
-->

<div 
  class='houseboy-slide-review-section'
  data-reviews='[
	{"id":20733981,"iconPosition":{"x":50,"y":50}},
	{"id":21185975,"iconPosition":{"x":30,"y":40}},
	{"id":33401761,"iconPosition":{"x":70,"y":60}},
	{"id":27208230,"iconPosition":{"x":20,"y":80}},
	{"id":25029734,"iconPosition":{"x":80,"y":20}},
	{"id":20734090},
	{"id":20734204,"iconPosition":{"x":50,"y":30}},
	{"id":39241145,"iconPosition":{"x":50,"y":70}},
	{"id":38484011,"iconPosition":{"x":10,"y":10}},
	{"id":38477472,"iconPosition":{"x":90,"y":90}}
  ]' 
>
</div>

<script>
{
  console.log('ìŠ¬ë¼ì´ë“œ ë¦¬ë·° ì„¹ì…˜ ë¡œë“œë¨');

  // VReview API í•¨ìˆ˜ë“¤
  const getVReviews = async (count) => {
    if (count > 24) {
      console.error('ë¦¬ë·° ìµœëŒ€ 24ê°œê¹Œì§€ ìš”ì²­ ê°€ëŠ¥.');
      return { results: [] };
    }
    
    try {
      const res = await fetch(
        `https://one.vreview.tv/api/embed/v2/d078aac4-6258-4061-bdbe-d93ab978f521/reviews?offset=0&limit=${count}&ordering=-helpful_count&expand=created_at%2Cproduct%2Crating`,
        {
          referrerPolicy: 'no-referrer',
          headers: { 'Accept': 'application/json' }
        }
      );
      
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`);
      }
      
      return await res.json();
    } catch (error) {
      console.error('ë¦¬ë·° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
      return { results: [] };
    }
  };
  
  const getVReviewData = async (reviewId) => {
    try {
      const res = await fetch(
        `https://one.vreview.tv/api/embed/v2/d078aac4-6258-4061-bdbe-d93ab978f521/reviews/${reviewId}`,
        {
          referrerPolicy: 'no-referrer',
          headers: { 'Accept': 'application/json' }
        }
      );
      
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`);
      }
      
      return await res.json();
    } catch (error) {
      console.error('ë¦¬ë·° ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
      return null;
    }
  };
  
  const getProdData = async (prodId) => {
    try {
      const res = await fetch(`/ajax/oms/OMS_get_product.cm?prod_idx=${prodId}`, {
        method: 'GET',
        credentials: 'include',
        headers: {
          'Accept': '*/*',
          'Accept-Language': 'ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7'
        }
      });
      
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`);
      }
      
      return await res.json();
    } catch (error) {
      console.error('ìƒí’ˆ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
      return null;
    }
  };
  
  // ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜
  const initReviewSlider = async () => {
    try {
      const reviewPositions = document.querySelectorAll(".houseboy-slide-review-section");
      
      if (reviewPositions.length === 0) {
        console.warn('ë¦¬ë·° ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ê° ìœ„ì¹˜ë§ˆë‹¤ ê°œë³„ì ìœ¼ë¡œ ì²˜ë¦¬
      for (const newReviewPosition of reviewPositions) {
      
      const review = document.createElement('div');
      review.classList.add('hb-review', 'hb-section');
      
      // ëª¨ë“  ë¦¬ë·° ë°ì´í„°ë¥¼ ë³‘ë ¬ë¡œ ê°€ì ¸ì˜¤ê¸°
      const reviewData = JSON.parse(newReviewPosition.dataset.reviews);
      if (!Array.isArray(reviewData)) {
        console.warn('ë¦¬ë·° ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ìŠ¤í‚µí•©ë‹ˆë‹¤.');
        continue;
      }
      const reviewPromises = reviewData.map(async (item, index) => {
        const vReview = await getVReviewData(item.id);
        
        // vReview ë°ì´í„°ë¥¼ ì „ì—­ìœ¼ë¡œ ì €ì¥í•´ì„œ ë‚˜ì¤‘ì— ëª¨ë‹¬ì—ì„œ ì‚¬ìš©
        if (!window.vReviewsData) {
          window.vReviewsData = {};
        }
        if (vReview) {
          window.vReviewsData[item.id] = vReview;
        }
        
        if (!vReview) return '';
        
        // ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ê°€ ìˆëŠ” ê²½ìš°ë§Œ ì¹´ë“œ ìƒì„±
        if (vReview.media_contents && 
            vReview.media_contents[0] && 
            vReview.media_contents[0].type === 'image' && 
            vReview.text) {
          
          // XSS ë°©ì§€ë¥¼ ìœ„í•œ ê¸°ë³¸ì ì¸ í…ìŠ¤íŠ¸ ì´ìŠ¤ì¼€ì´í•‘
          const escapeHtml = (text) => {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
          };
          
          // ì•„ì´ì½˜ HTML ìƒì„± (ì¢Œí‘œê°€ ìˆëŠ” ê²½ìš°ë§Œ)
          let iconHtml = '';
          let productCardHtml = '';
          
          if (item.iconPosition) {
            const { x, y } = item.iconPosition;
            
            // ìƒí’ˆ ì •ë³´ê°€ ìˆìœ¼ë©´ ë¯¸ë¦¬ ì¹´ë“œ HTML ìƒì„±
            if (vReview.product_origin_id) {
              // ìƒí’ˆ ë°ì´í„° ë¯¸ë¦¬ ê°€ì ¸ì˜¤ê¸°
              const productData = await getProdData(vReview.product_origin_id);
              
              if (productData && productData.msg === 'SUCCESS') {
                const product = productData.data;
                const discountRate = Math.round((1 - product.price / product.price_org) * 100);
                
                productCardHtml = `
                  <div class='hb-product-mini-card' key=${index} data-product-id='${vReview.product_origin_id}' style='display: none;'>
                    <img src='${product.image_url[product.images[0]]}' alt='${product.name}' class='hb-product-mini-image' />
                    <div class='hb-product-mini-info'>
                      <div class='hb-product-mini-name'>${product.name}</div>
                      <div class='hb-product-mini-price'>
                        <span class='hb-product-mini-price-current'>${product.price.toLocaleString()}ì›</span>
                        ${product.price_org > product.price ? `
                          <span class='hb-product-mini-price-original'>${product.price_org.toLocaleString()}ì›</span>
                        ` : ''}
                      </div>
                    </div>
                  </div>
                `;
              }
            }
            
            iconHtml = `
              <div class='hb-review-icon' 
                key=${index}
                style='left: ${x}%; top: ${y}%;'
                data-product-id='${vReview.product_origin_id || ''}'
                data-state='closed'
              >
                <svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg' style='transition: transform 0.2s ease;'>
                  <circle cx='12' cy='12' r='11' fill='#212121' stroke='#333' stroke-width='1'/>
                  <path d='M12 6v12M6 12h12' stroke='white' stroke-width='2' stroke-linecap='round'/>
                </svg>
                ${productCardHtml}
              </div>
            `;
          }
          
          return `
            <div class='hb-review-card' data-review-id='${item.id}'>
              <div class='hb-review-thumbnail-image-wrap'>
                <img 
                  class='hb-review-thumbnail-image'
                  src='${vReview.media_contents[0].urls.origin}' 
                  alt='ë¦¬ë·° ì´ë¯¸ì§€'
                  loading='lazy'
                  draggable='false'
                  onerror="this.style.display='none'"
                />
                ${iconHtml}
              </div>
              <span class='hb-review-comment'>
                ${escapeHtml(vReview.text)}
              </span>
            </div>
          `;
        }
        
        return '';
      });
      
      // Promise.allë¡œ ëª¨ë“  ë¹„ë™ê¸° ì‘ì—… ì™„ë£Œ ëŒ€ê¸°
      const reviewContent = await Promise.all(reviewPromises);
      
      // ë¹ˆ ë¬¸ìì—´ í•„í„°ë§
      const filteredContent = reviewContent.filter(content => content);
      
      if (filteredContent.length === 0) {
        console.warn('í‘œì‹œí•  ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤. ìŠ¤í‚µí•©ë‹ˆë‹¤.');
        continue;
      }
      
      // HTML ì‚½ì…
      review.innerHTML = `
        <div class='hb-section-container'>
          <div class='hb-review-content-wrap'>
            <h3 class='hb-review-title'>
              <span>
                í•˜ìš°ìŠ¤ë³´ì´ì™€ í•¨ê»˜í•˜ëŠ” 
              </span>
              <span>
                ì˜¨ë¼ì¸ ì§‘ë“¤ì´ ğŸ 
              </span>
            </h3>
            <div class='hb-review-content'>
              ${filteredContent.join('')}
            </div>
          </div>
        </div>
      `;
      
      // DOMì— ì¶”ê°€
      newReviewPosition.appendChild(review);
  
      // ìŠ¬ë¼ì´ë” ê¸°ëŠ¥ ì´ˆê¸°í™”
      const slider = review.querySelector('.hb-review-content');
      
      // ì´ë¯¸ì§€ ë“œë˜ê·¸ ë°©ì§€
      review.querySelectorAll('.hb-review-thumbnail-image').forEach(img => {
        img.addEventListener('dragstart', (e) => {
          e.preventDefault();
        });
      });
      
      if (slider) {
        let isDown = false;
        let startX;
        let scrollLeft;
        let hasDragged = false; // ë“œë˜ê·¸ ì—¬ë¶€ ì¶”ì 
        
        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
        slider.addEventListener('mousedown', (e) => {
          // ì•„ì´ì½˜ì´ë‚˜ ìƒí’ˆ ì¹´ë“œ í´ë¦­ ì‹œ ë“œë˜ê·¸ ë°©ì§€
          if (e.target.closest('.hb-review-icon') || 
              e.target.closest('.hb-product-mini-card')) return;
          
          isDown = true;
          hasDragged = false;
          slider.classList.add('grabbing');
          startX = e.pageX - slider.offsetLeft;
          scrollLeft = slider.scrollLeft;
        });
        
        slider.addEventListener('mouseleave', () => {
          isDown = false;
          slider.classList.remove('grabbing');
        });
        
        slider.addEventListener('mouseup', () => {
          isDown = false;
          slider.classList.remove('grabbing');
        });
        
        slider.addEventListener('mousemove', (e) => {
          if (!isDown) return;
          e.preventDefault();
          
          const x = e.pageX - slider.offsetLeft;
          const walk = (x - startX) * 1.5;
          
          // ì¼ì • ê±°ë¦¬ ì´ìƒ ì›€ì§ì¸ ê²½ìš°ë§Œ ë“œë˜ê·¸ë¡œ íŒë‹¨
          if (Math.abs(walk) > 5) {
            hasDragged = true;
            slider.scrollLeft = scrollLeft - walk;
          }
        });
        
        // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ ì§€ì›)
        slider.addEventListener('touchstart', (e) => {
          if (e.target.closest('.hb-review-icon') || 
              e.target.closest('.hb-product-mini-card')) return;
          
          isDown = true;
          hasDragged = false;
          slider.classList.add('grabbing');
          startX = e.touches[0].pageX - slider.offsetLeft;
          scrollLeft = slider.scrollLeft;
        }, { passive: true });
        
        slider.addEventListener('touchend', () => {
          isDown = false;
          slider.classList.remove('grabbing');
        });
        
        slider.addEventListener('touchmove', (e) => {
          if (!isDown) return;
          
          const x = e.touches[0].pageX - slider.offsetLeft;
          const walk = (x - startX) * 1.5;
          
          // ì¼ì • ê±°ë¦¬ ì´ìƒ ì›€ì§ì¸ ê²½ìš°ë§Œ ë“œë˜ê·¸ë¡œ íŒë‹¨
          if (Math.abs(walk) > 5) {
            hasDragged = true;
            slider.scrollLeft = scrollLeft - walk;
          }
        }, { passive: true });
      }
      
      // ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸ - ì¹´ë“œ í† ê¸€
      review.querySelectorAll('.hb-review-icon').forEach((icon) => {
        icon.addEventListener('click', (e) => {
          e.stopPropagation();
          
          // í˜„ì¬ ì—´ë ¤ìˆëŠ” ë‹¤ë¥¸ ì¹´ë“œë“¤ê³¼ ì•„ì´ì½˜ë“¤ ëª¨ë‘ ë‹«ê¸°
          document.querySelectorAll('.hb-review-icon').forEach(otherIcon => {
            if (icon !== otherIcon) {
              const otherWrapper = otherIcon.closest('.hb-review-thumbnail-image-wrap');
              const otherCard = otherWrapper.querySelector('.hb-product-mini-card');
              
              if (otherCard && otherCard.style.display === 'flex') {
                otherCard.style.display = 'none';
                // ë‹¤ë¥¸ ì•„ì´ì½˜ë“¤ì„ + ìƒíƒœë¡œ ë³€ê²½ (íšŒì „ ì´ˆê¸°í™”)
                const otherSvg = otherIcon.querySelector('svg');
                if (otherSvg) {
                  otherSvg.style.transform = 'rotate(0deg)';
                  otherIcon.setAttribute('data-state', 'closed');
                }
              }
            }
          });
          
          // í•´ë‹¹ ì•„ì´ì½˜ì˜ ì¹´ë“œ ì°¾ê¸°
          const wrapper = icon.closest('.hb-review-thumbnail-image-wrap');
          const card = wrapper.querySelector('.hb-product-mini-card');
          const svg = icon.querySelector('svg');
          
          if (card && svg) {
            // í† ê¸€
            if (card.style.display === 'flex') {
              // ì¹´ë“œ ë‹«ê¸°
              card.style.display = 'none';
              svg.style.transform = 'rotate(0deg)';
              icon.setAttribute('data-state', 'closed');
            } else {
              // ì¹´ë“œ ì—´ê¸°
              card.style.display = 'flex';
              svg.style.transform = 'rotate(45deg)';
              icon.setAttribute('data-state', 'opened');
            }
          }
        });
      });
      
      // ìƒí’ˆ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸
      review.querySelectorAll('.hb-product-mini-card').forEach((card) => {
        card.addEventListener('click', (e) => {
          e.stopPropagation();
          const productId = card.getAttribute('data-product-id');
          // ìƒí’ˆ í˜ì´ì§€ë¡œ ì´ë™ (ì‹¤ì œ ìƒí’ˆ í˜ì´ì§€ URL êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •)
          window.location.href = `/shop_view/?idx=${productId}`;
        });
      });
      
      // ë¦¬ë·° ì´ë¯¸ì§€ í´ë¦­ ì´ë²¤íŠ¸ - ëª¨ë‹¬ ì—´ê¸°
      review.querySelectorAll('.hb-review-thumbnail-image').forEach((img) => {
        let mouseDownX, mouseDownY;
        let hasMouseMoved = false;
        let isMouseDown = false;
        
        img.addEventListener('mousedown', (e) => {
          mouseDownX = e.pageX;
          mouseDownY = e.pageY;
          hasMouseMoved = false;
          isMouseDown = true;
          
          const mouseMoveHandler = (moveEvent) => {
            if (!isMouseDown) return;
            
            const deltaX = Math.abs(moveEvent.pageX - mouseDownX);
            const deltaY = Math.abs(moveEvent.pageY - mouseDownY);
            
            // 5px ì´ìƒ ì›€ì§ì´ë©´ ë“œë˜ê·¸ë¡œ íŒë‹¨
            if (deltaX > 5 || deltaY > 5) {
              hasMouseMoved = true;
            }
          };
          
          const mouseUpHandler = () => {
            isMouseDown = false;
            document.removeEventListener('mousemove', mouseMoveHandler);
            document.removeEventListener('mouseup', mouseUpHandler);
            
            // ë§ˆìš°ìŠ¤ì—… ì‹œì ì—ì„œ ì›€ì§ì„ì´ ì—†ì—ˆë‹¤ë©´ ëª¨ë‹¬ ì—´ê¸°
            if (!hasMouseMoved) {
              // ë¦¬ë·° ì¹´ë“œì—ì„œ ë¦¬ë·° ID ê°€ì ¸ì˜¤ê¸°
              const reviewCard = img.closest('.hb-review-card');
              const reviewId = reviewCard.getAttribute('data-review-id');
              
              // ì €ì¥ëœ vReview ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
              if (window.vReviewsData && window.vReviewsData[reviewId]) {
                openReviewModal(window.vReviewsData[reviewId]);
              }
            }
          };
          
          document.addEventListener('mousemove', mouseMoveHandler);
          document.addEventListener('mouseup', mouseUpHandler);
        });
        
        // click ì´ë²¤íŠ¸ëŠ” ë¬´ì¡°ê±´ ë°©ì§€ (mouseupì—ì„œ ì²˜ë¦¬)
        img.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
        });
      });
      
      // ì™¸ë¶€ í´ë¦­ ì‹œ ëª¨ë“  ì¹´ë“œ ë‹«ê¸°
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.hb-review-icon') && !e.target.closest('.hb-product-mini-card')) {
          document.querySelectorAll('.hb-product-mini-card').forEach(card => {
            card.style.display = 'none';
          });
          
          // ëª¨ë“  ì•„ì´ì½˜ì„ + ìƒíƒœë¡œ ë³€ê²½ (íšŒì „ ì´ˆê¸°í™”)
          document.querySelectorAll('.hb-review-icon').forEach(icon => {
            const svg = icon.querySelector('svg');
            if (svg) {
              svg.style.transform = 'rotate(0deg)';
              icon.setAttribute('data-state', 'closed');
            }
          });
        }
      });
      
      } // forë¬¸ ë
    } catch (error) {
      console.error('ë¦¬ë·° ìŠ¬ë¼ì´ë” ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
    }
  };
  
  // ëª¨ë‹¬ ìƒì„± í•¨ìˆ˜
  const createReviewModal = () => {
    const modal = document.createElement('div');
    modal.id = 'hb-review-modal';
    modal.innerHTML = `
      <div class="hb-modal-backdrop" id="hb-modal-backdrop">
        <div class="hb-modal-content-wrapper">
          <div class="hb-modal-header">
            <p class="hb-modal-title">ë¦¬ë·° ìƒì„¸ ë³´ê¸°</p>
            <div class="hb-modal-close" id="hb-modal-close">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256">
                <path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path>
              </svg>
            </div>
          </div>
          <div class="hb-modal-body">
            <div class="hb-modal-product-info">
              <img class="hb-modal-product-image" src="" alt="">
              <div class="hb-modal-product-details">
                <p class="hb-modal-product-name"></p>
                <p class="hb-modal-product-rating"></p>
              </div>
            </div>
            <div class="hb-modal-image-section">
              <div class="hb-modal-main-image">
                <img class="hb-modal-current-image" src="" alt="">
              </div>
              <div class="hb-modal-thumbnail-container">
                <div class="hb-modal-thumbnails"></div>
              </div>
            </div>
            <div class="hb-modal-user-info">
              <div class="hb-modal-user-details">
                <p class="hb-modal-username"></p>
              </div>
              <div class="hb-modal-user-attributes"></div>
              <p class="hb-modal-purchase-options"></p>
            </div>
            <div class="hb-modal-review-content">
              <div class="hb-modal-rating-section">
                <div class="hb-modal-stars"></div>
                <div class="hb-modal-questions"></div>
              </div>
              <p class="hb-modal-review-text"></p>
            </div>
          </div>
        </div>
      </div>
    `;
    
    // bodyê°€ ì•„ë‹Œ ë‹¤ë¥¸ ìœ„ì¹˜ì— ì¶”ê°€ ì‹œë„
    const targetContainer = document.querySelector('.houseboy-slide-review-section') || document.querySelector('.hb-review');
    if (targetContainer) {
      targetContainer.appendChild(modal);
    } else {
      document.body.appendChild(modal);
    }
    
    return modal;
  };
  
  // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
  const openReviewModal = (vReview) => {
    let modal = document.getElementById('hb-review-modal');
    if (!modal) {
      modal = createReviewModal();
    }
    
    // ë°ì´í„° ì±„ìš°ê¸°
    populateModalData(modal, vReview);
    
    modal.style.setProperty('display', 'block', 'important');
    modal.style.setProperty('visibility', 'visible', 'important');
    modal.style.setProperty('opacity', '1', 'important');
    modal.style.setProperty('z-index', '99999', 'important');
    document.body.style.overflow = 'hidden';
    
    // ë‹«ê¸° ì´ë²¤íŠ¸ ì„¤ì •
    const closeBtn = modal.querySelector('#hb-modal-close');
    const backdrop = modal.querySelector('#hb-modal-backdrop');
    
    const closeModal = () => {
      modal.style.display = 'none';
      document.body.style.overflow = '';
    };
    
    closeBtn.onclick = closeModal;
    backdrop.onclick = (e) => {
      // ë°±ë“œë¡­ ìì²´ë¥¼ í´ë¦­í–ˆì„ ë•Œë§Œ ë‹«ê¸° (ëª¨ë‹¬ ë‚´ìš© í´ë¦­ ì‹œì—ëŠ” ë‹«ì§€ ì•ŠìŒ)
      if (e.target === backdrop) {
        closeModal();
      }
    };
    
    // ESC í‚¤ë¡œ ë‹«ê¸°
    const handleEsc = (e) => {
      if (e.key === 'Escape') {
        closeModal();
        document.removeEventListener('keydown', handleEsc);
      }
    };
    document.addEventListener('keydown', handleEsc);
  };
  
  // ëª¨ë‹¬ ë°ì´í„° ì±„ìš°ê¸° í•¨ìˆ˜
  const populateModalData = async (modal, vReview) => {
    try {
      // ìƒí’ˆ ì •ë³´ ì±„ìš°ê¸°
      if (vReview.product) {
        const productImg = modal.querySelector('.hb-modal-product-image');
        const productName = modal.querySelector('.hb-modal-product-name');
        const productRating = modal.querySelector('.hb-modal-product-rating');
        
        productImg.src = vReview.product.image_url_recorded;
        productName.textContent = vReview.product.name;
        productRating.textContent = `â˜… ${vReview.product.total_rating_average} (${vReview.product.review_total_count})`;
        
        // ìƒí’ˆ ì´ë¦„ í´ë¦­ ì‹œ ìƒí’ˆ í˜ì´ì§€ ìƒˆì°½ìœ¼ë¡œ ì—´ê¸°
        productName.style.cursor = 'pointer';
        productName.addEventListener('click', () => {
          const productUrl = `/shop_view/?idx=${vReview.product.remote_id}`;
          window.open(productUrl, '_blank');
        });
        
        // ìƒí’ˆ ì´ë¯¸ì§€ í´ë¦­ ì‹œì—ë„ ìƒí’ˆ í˜ì´ì§€ ìƒˆì°½ìœ¼ë¡œ ì—´ê¸°
        productImg.style.cursor = 'pointer';
        productImg.addEventListener('click', () => {
          const productUrl = `/shop_view/?idx=${vReview.product.remote_id}`;
          window.open(productUrl, '_blank');
        });
      }
      
      // ì´ë¯¸ì§€ ì„¹ì…˜ ì±„ìš°ê¸°
      if (vReview.media_contents && vReview.media_contents.length > 0) {
        const mainImage = modal.querySelector('.hb-modal-current-image');
        const thumbnailsContainer = modal.querySelector('.hb-modal-thumbnails');
        
        // ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë¥¼ ë©”ì¸ìœ¼ë¡œ ì„¤ì •
        mainImage.src = vReview.media_contents[0].urls.origin;
        
        // ì¸ë„¤ì¼ë“¤ ìƒì„±
        thumbnailsContainer.innerHTML = '';
        vReview.media_contents.forEach((media, index) => {
          if (media.type === 'image') {
            const thumbnail = document.createElement('div');
            thumbnail.className = `hb-modal-thumbnail ${index === 0 ? 'active' : ''}`;
            thumbnail.innerHTML = `<img src="${media.urls.origin}" alt="">`;
            
            thumbnail.addEventListener('click', () => {
              // ê¸°ì¡´ active ì œê±°
              modal.querySelectorAll('.hb-modal-thumbnail').forEach(t => t.classList.remove('active'));
              thumbnail.classList.add('active');
              
              // ë©”ì¸ ì´ë¯¸ì§€ ë³€ê²½
              mainImage.src = media.urls.origin;
            });
            
            thumbnailsContainer.appendChild(thumbnail);
          }
        });
      }
      
      // ì‚¬ìš©ì ì •ë³´ ì±„ìš°ê¸°
      const username = modal.querySelector('.hb-modal-username');
      const userAttributes = modal.querySelector('.hb-modal-user-attributes');
      const purchaseOptions = modal.querySelector('.hb-modal-purchase-options');
      
      username.textContent = vReview.user_nickname;
      
      // ì‚¬ìš©ì ì†ì„±ë“¤ ì±„ìš°ê¸°
      userAttributes.innerHTML = '';
      if (vReview.questions) {
        const userInfoQuestions = vReview.questions.filter(q => q.question_type === 'userinfo');
        userInfoQuestions.forEach((question, index) => {
          const attr = document.createElement('span');
          attr.className = 'hb-modal-user-attribute';
          attr.innerHTML = `${index > 0 ? '<span class="mx-1">Â·</span>' : ''}<b>${question.question} </b>${question.answer}`;
          userAttributes.appendChild(attr);
        });
      }
      
      // êµ¬ë§¤ ì˜µì…˜ ì±„ìš°ê¸°
      if (vReview.selected_options) {
        const options = vReview.selected_options.map(opt => `${opt.name}: ${opt.value}`).join(' / ');
        purchaseOptions.textContent = `êµ¬ë§¤ì˜µì…˜: ${options}`;
      }
      
      // ë³„ì  ì±„ìš°ê¸°
      const starsContainer = modal.querySelector('.hb-modal-stars');
      starsContainer.innerHTML = '';
      for (let i = 0; i < 5; i++) {
        const star = document.createElement('svg');
        star.className = 'hb-modal-star';
        star.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256">
            <path d="M234.29,114.85l-45,38.83L203,211.75a16.4,16.4,0,0,1-24.5,17.82L128,198.49,77.47,229.57A16.4,16.4,0,0,1,53,211.75l13.76-58.07-45-38.83A16.46,16.46,0,0,1,31.08,86l59-4.76,22.76-55.08a16.36,16.36,0,0,1,30.27,0l22.75,55.08,59,4.76a16.46,16.46,0,0,1,9.37,28.86Z"></path>
          </svg>
        `;
        if (i < vReview.rating) {
          star.style.color = '#ffc107';
        } else {
          star.style.color = '#e0e0e0';
        }
        starsContainer.appendChild(star);
      }
      
      // ì§ˆë¬¸ë“¤ ì±„ìš°ê¸°
      const questionsContainer = modal.querySelector('.hb-modal-questions');
      questionsContainer.innerHTML = '';
      if (vReview.questions) {
        const statisticalQuestions = vReview.questions.filter(q => q.question_type === 'statistical');
        statisticalQuestions.forEach(question => {
          const questionDiv = document.createElement('div');
          questionDiv.className = 'hb-modal-question';
          questionDiv.innerHTML = `
            <span class="hb-modal-question-label">${question.question}</span>
            <span class="hb-modal-question-answer">${question.answer}</span>
          `;
          questionsContainer.appendChild(questionDiv);
        });
      }
      
      // ë¦¬ë·° í…ìŠ¤íŠ¸ ì±„ìš°ê¸°
      const reviewText = modal.querySelector('.hb-modal-review-text');
      reviewText.textContent = vReview.text;
      
    } catch (error) {
      console.error('ëª¨ë‹¬ ë°ì´í„° ì±„ìš°ê¸° ì‹¤íŒ¨:', error);
    }
  };

  initReviewSlider();
}
</script>

<style>
/* === ê³µí†µ ì„¹ì…˜ êµ¬ì¡° ìŠ¤íƒ€ì¼ === */
.hb-section {

}

.hb-section-container {

}

/* === ë¦¬ë·° ì„¹ì…˜ ìŠ¤íƒ€ì¼ === */
.hb-review {

}

.hb-review-content-wrap {
  display: flex;
  flex-direction: column;
  gap: 24px;
  overflow: hidden;
}

.hb-review-title {
  width: 100%; /* ë¶€ëª¨ ì»¨í…Œì´ë„ˆ ë„ˆë¹„ì— ë§ì¶¤ */
  font-weight: 600 !important;
  font-size: 24px !important;
  color: #212121 !important;
  text-align: center;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
}

.hb-review-content {
  display: flex;
  gap: 7px;
  overflow: hidden; /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
  user-select: none; /* ë“œë˜ê·¸ ì¤‘ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
  flex-wrap: nowrap; /* ìì‹ ìš”ì†Œë“¤ì´ í•œ ì¤„ì— ìˆë„ë¡ ì„¤ì • */
  -webkit-user-select: none; /* Webkit ë¸Œë¼ìš°ì €ìš© */
  -moz-user-select: none; /* Firefoxìš© */
  -ms-user-select: none; /* IE/Edgeìš© */
}

.hb-review-card {
  display: flex;
  flex-shrink: 0; /* ì¹´ë“œ ìš”ì†Œê°€ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ ì„¤ì • */
  flex-direction: column;
  width: 242px; /* ì´ë¯¸ì§€ ë„ˆë¹„ì— ë§ì¶° ì¹´ë“œ ë„ˆë¹„ ëª…ì‹œ */
  position: relative; /* ì¶”ê°€ - ë¯¸ë‹ˆ ì¹´ë“œ ìœ„ì¹˜ ê¸°ì¤€ */
}

.hb-review-thumbnail-image-wrap {
  position: relative;
  width: 242px;
  height: 346px;
  overflow: visible; /* ë³€ê²½ - ë¯¸ë‹ˆ ì¹´ë“œê°€ ë³´ì´ë„ë¡ */
}

.hb-review-thumbnail-image {
  width: 100%;
  height: 100%;
  border-radius: 5px;
  object-fit: cover;
}

.hb-review-comment {
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
  font-weight: 600;
  font-size: 16px;
  width: 100%; /* ë¶€ëª¨ ë„ˆë¹„ì— ë§ì¶¤ */
  padding: 0 40px; /* ë‚´ë¶€ ì—¬ë°±ìœ¼ë¡œ í…ìŠ¤íŠ¸ ì˜ì—­ ì œí•œ */
  margin-top: 18px;
  box-sizing: border-box; /* íŒ¨ë”©ì´ ë„ˆë¹„ì— í¬í•¨ë˜ë„ë¡ ì„¤ì • */
}

/* ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
.hb-review-icon {
  position: absolute;
  transform: translate(-50%, -50%);
  cursor: pointer;
  z-index: 10;
  transition: transform 0.2s ease;
}

.hb-review-icon svg {
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

/* ë¯¸ë‹ˆ ìƒí’ˆ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.hb-product-mini-card {
  position: absolute;
  background: white;
  border-radius: 4px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  display: none;
  align-items: center;
  gap: 8px;
  width: 160px;
  height: 50px;
  z-index: 9999;
  overflow: hidden;
  cursor: pointer;
}

.hb-review-icon .hb-product-mini-card .hb-product-mini-image {
  width: 50px;
  height: 50px;
  border-radius: 4px;
  object-fit: cover;
  flex-shrink: 0;
}

.hb-review-icon .hb-product-mini-card .hb-product-mini-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
  overflow: hidden;
}

.hb-review-icon .hb-product-mini-card .hb-product-mini-info .hb-product-mini-name {
  font-size: 9px;
  font-weight: 600;
  color: #333;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.hb-review-icon .hb-product-mini-card .hb-product-mini-info .hb-product-mini-brand {
  font-size: 5px;
  color: #888;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.hb-review-icon .hb-product-mini-card .hb-product-mini-info .hb-product-mini-price {
  display: flex;
  align-items: center;
  gap: 4px;
}

.hb-product-mini-card .hb-product-mini-info .hb-product-mini-price .hb-product-mini-price-current {
  font-size: 10px;
  font-weight: 700;
  color: #271f20;
}

.hb-product-mini-card .hb-product-mini-info .hb-product-mini-price .hb-product-mini-price-original {
  font-size: 11px;
  color: #999;
  text-decoration: line-through;
}

/* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
#hb-review-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 99999;
}

#hb-review-modal[style*="display: block"] {
  display: block !important;
}

.hb-modal-backdrop {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.hb-modal-content-wrapper {
  width: 480px;
  height: 720px;
  max-width: 90vw;
  max-height: 90vh;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  overflow: hidden;
}

.hb-modal-content {
  position: relative;
  width: 100%;
  height: 100%;
  user-select: none;
  overflow: hidden;
  overflow-y: auto;
}

.hb-modal-header {
  width: 100%;
  padding: 12px 16px;
  position: relative;
}

.hb-modal-title {
  font-size: 15px;
  font-weight: 600;
  color: #333;
  text-align: center;
  margin: 0;
  line-height: 1.4;
}

.hb-modal-close {
  position: absolute;
  right: 8px;
  top: 8px;
  display: flex;
  width: 32px;
  height: 32px;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
}

.hb-modal-close:hover {
  background: rgba(0, 0, 0, 0.05);
}

.hb-modal-close svg {
  width: 16px;
  height: 16px;
  color: #666;
}

.hb-modal-body {
  background: #f8f9fa;
  position: relative;
  display: flex;
  height: calc(100% - 56px);
  flex-direction: column;
  gap: 16px;
  overflow-y: auto;
  padding-bottom: 120px;
}

.hb-modal-product-info {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 12px 16px 0;
}

.hb-modal-product-image {
  width: 32px;
  height: 32px;
  margin: 2px 0;
  cursor: pointer;
  border-radius: 4px;
  object-fit: cover;
}

.hb-modal-product-details {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.hb-modal-product-name {
  font-size: 14px;
  font-weight: 500;
  color: #333;
  cursor: pointer;
  line-height: 18px;
  margin: 0;
}

.hb-modal-product-rating {
  color: #666;
  font-size: 12px;
  font-weight: 500;
  line-height: 14px;
  margin: 0;
}

.hb-modal-image-section {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.hb-modal-main-image {
  position: relative;
  height: 480px;
  overflow: hidden;
  border-radius: 6px;
  background: black;
  margin: 0 16px;
}

.hb-modal-current-image {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.hb-modal-thumbnail-container {
  display: flex;
  align-items: center;
  justify-content: center;
}

.hb-modal-thumbnails {
  display: flex;
  max-width: 100%;
  gap: 6px;
  overflow-x: auto;
  padding: 0 16px;
}

.hb-modal-thumbnail {
  position: relative;
  width: 40px;
  height: 40px;
  flex-shrink: 0;
  cursor: pointer;
  overflow: hidden;
  border-radius: 4px;
  border: 2px solid transparent;
}

.hb-modal-thumbnail.active {
  border-color: #007bff;
}

.hb-modal-thumbnail:not(.active)::after {
  content: '';
  position: absolute;
  inset: 0;
  width: 40px;
  height: 40px;
  background: rgba(0, 0, 0, 0.3);
}

.hb-modal-thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.hb-modal-user-info {
  display: flex;
  flex-direction: column;
  gap: 6px;
  background: #e9ecef;
  border-radius: 6px;
  padding: 12px;
  margin: 0 16px;
}

.hb-modal-user-details {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.hb-modal-username {
  font-size: 12px;
  font-weight: 600;
  color: #333;
  line-height: 17px;
  margin: 0;
}

.hb-modal-user-attributes {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 4px;
}

.hb-modal-user-attribute {
  color: #666;
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
}

.hb-modal-purchase-options {
  font-size: 12px;
  font-weight: 400;
  color: #666;
  line-height: 17px;
  margin: 0;
}

.hb-modal-review-content {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 0 16px;
}

.hb-modal-rating-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.hb-modal-stars {
  display: flex;
  gap: 1px;
}

.hb-modal-star {
  width: 14px;
  height: 14px;
  color: #ffc107;
}

.hb-modal-questions {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.hb-modal-question {
  display: flex;
  align-items: center;
  gap: 8px;
}

.hb-modal-question-label {
  font-size: 12px;
  font-weight: 600;
  color: #333;
}

.hb-modal-question-answer {
  font-size: 12px;
  font-weight: 400;
  color: #333;
}

.hb-modal-review-text {
  font-size: 14px;
  font-weight: 400;
  color: #333;
  word-break: break-all;
  line-height: 1.4;
  margin: 0;
  white-space: pre-line;
}

.hb-modal-actions {
  display: flex;
  align-items: center;
  gap: 32px;
  padding: 0 16px;
}

.hb-modal-helpful,
.hb-modal-comments {
  display: flex;
  cursor: pointer;
  align-items: center;
  gap: 4px;
}

.hb-modal-helpful svg,
.hb-modal-comments svg {
  color: #6c757d;
}

.hb-modal-helpful-text,
.hb-modal-comments-text {
  font-size: 14px;
  font-weight: 400;
  color: #666;
}

.hb-modal-report {
  font-size: 14px;
  font-weight: 400;
  color: #666;
  margin-left: auto;
  cursor: pointer;
}

.hb-modal-comments-section {
  border-top: 4px solid rgba(0, 0, 0, 0.03);
  padding-top: 0;
}

.hb-modal-comments-title {
  font-size: 14px;
  font-weight: 400;
  color: #333;
  padding: 12px 16px;
  margin: 0;
}

.hb-modal-no-comments {
  font-size: 14px;
  font-weight: 400;
  color: #666;
  padding: 16px;
  text-align: center;
  margin: 0;
}

.hide-scrollbar {
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.hide-scrollbar::-webkit-scrollbar {
  display: none;
}

@media (max-width: 768px) {
  .hb-section {
    margin-left: -15px;
    margin-right: -15px;
  }
  
  .hb-review-title {
    flex-direction: column;
    white-space: normal;
    gap: 4px;
  }

  .hb-review-content-wrap {
  }

  .hb-review-content {
    display: flex;
    gap: 7px;
    overflow: hidden; /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
    user-select: none; /* ë“œë˜ê·¸ ì¤‘ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
    flex-wrap: nowrap; /* ìì‹ ìš”ì†Œë“¤ì´ í•œ ì¤„ì— ìˆë„ë¡ ì„¤ì • */
    -webkit-user-select: none; /* Webkit ë¸Œë¼ìš°ì €ìš© */
    -moz-user-select: none; /* Firefoxìš© */
    -ms-user-select: none; /* IE/Edgeìš© */
	padding: 0 7px;
  }

  .hb-modal-content {
    height: 100vh;
    width: 100vw;
    max-height: 100vh;
    max-width: 100vw;
    border-radius: 0;
  }
  
  .hb-modal-backdrop {
    padding: 0;
  }
}

/* ì• ë‹ˆë©”ì´ì…˜ - íŒŒì¼ ëì— ìœ„ì¹˜ */
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

</style>
